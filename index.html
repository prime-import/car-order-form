<script>
document.getElementById('carForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const telegram = document.getElementById('telegram').value.trim();
  const from = document.getElementById('from').value;
  const car = document.getElementById('car').value.trim();
  const budget = document.getElementById('budget').value.trim();

  const WEBHOOK = 'https://b24-ynu924.bitrix24.ru/rest/1/oj5dbvbaueer7z1g/crm.lead.add.json';

  const body = {
    fields: {
      TITLE: 'Заявка на подбор авто',
      NAME: name,
      PHONE: [
        {
          VALUE: phone,
          VALUE_TYPE: 'WORK'
        }
      ],
      COMMENTS:
        'Telegram: ' + telegram + '\n' +
        'Откуда авто: ' + from + '\n' +
        'Марка / модель: ' + car + '\n' +
        'Бюджет: ' + budget
    }
  };

  try {
    const response = await fetch(WEBHOOK, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body)
    });

    const result = await response.json();

    if (result.result) {
      alert('Заявка отправлена!');
    } else {
      alert('Ошибка Bitrix. Проверь вебхук.');
      console.error(result);
    }

  } catch (error) {
    console.error(error);
    alert('Ошибка соединения');
  }
});
</script>
